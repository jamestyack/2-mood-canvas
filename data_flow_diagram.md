# 🎨 MoodCanvas Data Flow

## User Input → Playlist + Image Generation

```
👤 USER INPUT
"I feel like floating through fog at dawn"
           │
           ▼
┌─────────────────────────────────────────┐
│         🧠 GPT-4o MOOD ANALYSIS         │
│        (mood_to_music.py)               │
│                                         │
│ PROMPT TO GPT-4o:                       │
│ "Analyze this mood and return JSON:     │
│  - emotional_tags: 2-3 emotions         │
│  - genres: 2-3 music genres             │
│  - playlist_name: creative name"        │
└─────────────────────────────────────────┘
           │
           ▼
📋 GPT-4o OUTPUT (JSON)
{
  "emotional_tags": ["calm", "dreamy"],
  "genres": ["ambient", "folk"],
  "playlist_name": "Dawn Drift"
}
           │
           ▼
┌─────────────────┬───────────────────────┐
│                 │                       │
▼                 ▼                       ▼
```

## Left Path: 🎵 Spotify Playlist Creation

```
🎵 SPOTIFY SEARCH
(spotify_client.py)

INPUT: ["ambient", "folk"]
           │
           ▼
┌─────────────────────────────────────────┐
│    🔍 Spotify API Track Search          │
│                                         │
│ FOR EACH GENRE:                         │
│ • Query: "genre:ambient"                │
│ • Query: "genre:folk"                   │
│ • Fallback: search by keyword           │
│                                         │
│ RETURNS: List of track objects          │
│ [{                                      │
│   "name": "Song Name",                  │
│   "artist": "Artist Name",              │
│   "uri": "spotify:track:...",           │
│   "preview_url": "https://...",         │
│   "external_url": "https://..."        │
│ }]                                      │
└─────────────────────────────────────────┘
           │
           ▼
🎶 PLAYLIST CREATION
           │
           ▼
┌─────────────────────────────────────────┐
│    📝 Create Playlist with Metadata     │
│                                         │
│ NAME: "Dawn Drift"                      │
│                                         │
│ DESCRIPTION:                            │
│ "Generated by MoodCanvas 🎨 |           │
│  Mood: 'floating through fog at dawn' | │
│  Emotions: calm, dreamy |               │
│  Genres: ambient, folk"                 │
│                                         │
│ TRACKS: [5-15 track URIs]               │
└─────────────────────────────────────────┘
           │
           ▼
🎧 RESULT: Spotify Playlist URL
```

## Right Path: 🎨 Image Generation

```
🎨 IMAGE PROMPT CREATION
(image_generator.py)

INPUT: 
- emotional_tags: ["calm", "dreamy"]
- genres: ["ambient", "folk"] 
- mood_text: "floating through fog at dawn"
           │
           ▼
┌─────────────────────────────────────────┐
│       🧩 PROMPT ENGINEERING             │
│                                         │
│ 1. EMOTION → VISUAL MAPPING:            │
│    "calm" → "serene, peaceful, soft lighting" │
│    "dreamy" → "ethereal, floating elements"   │
│                                         │
│ 2. GENRE → AESTHETIC MAPPING:           │
│    "ambient" → "abstract soundwaves,    │
│                 atmospheric textures"   │
│    "folk" → "natural landscapes,        │
│              acoustic instruments"      │
│                                         │
│ 3. COMBINE INTO DALL-E PROMPT:          │
│    "Abstract visual representation of   │
│     'floating through fog at dawn'.     │
│     serene, peaceful, soft lighting,    │
│     ethereal, floating elements,        │
│     abstract soundwaves, atmospheric    │
│     textures, natural landscapes.       │
│     Digital art style, no text"         │
└─────────────────────────────────────────┘
           │
           ▼
🤖 DALL-E 3 API CALL
           │
           ▼
┌─────────────────────────────────────────┐
│         🎨 IMAGE GENERATION             │
│                                         │
│ • Model: "dall-e-3"                     │
│ • Size: 1024x1024                       │
│ • Quality: standard                     │
│                                         │
│ RETURNS: Image URL                      │
└─────────────────────────────────────────┘
           │
           ▼
📥 DOWNLOAD & CONVERT
           │
           ▼
🖼️ RESULT: Base64 Image Data
```

## Final Output to User

```
┌─────────────────────────────────────────┐
│            🎨 MOODCANVAS RESULT         │
│                                         │
│ 🎭 MOOD ANALYSIS:                       │
│    • Tags: calm, dreamy                 │
│    • Genres: ambient, folk              │
│                                         │
│ 🎵 SPOTIFY PLAYLIST:                    │
│    • Name: "Dawn Drift"                 │
│    • 15 tracks                          │
│    • Link to open in Spotify           │
│    • Rich metadata in description      │
│                                         │
│ 🎨 AI ARTWORK:                          │
│    • Visual representation of mood     │
│    • Download button for PNG file      │
│    • Generated based on emotions +     │
│      musical aesthetics                │
└─────────────────────────────────────────┘
```

## Key API Calls Made

1. **OpenAI GPT-4o** (`mood_to_music.py:analyze_mood()`)
   - Input: Mood text
   - Output: Structured emotional analysis

2. **Spotify Web API** (`spotify_client.py:search_tracks()`)
   - Input: Genre list
   - Output: Track metadata

3. **Spotify Web API** (`spotify_client.py:create_playlist()`)
   - Input: Track URIs + metadata
   - Output: Playlist URL

4. **OpenAI DALL-E 3** (`image_generator.py:generate_mood_image()`)
   - Input: Engineered visual prompt
   - Output: AI-generated artwork

## Code Files Involved

- `app.py` - Orchestrates the entire flow
- `mood_to_music.py` - GPT-4o mood analysis
- `spotify_client.py` - Playlist creation
- `image_generator.py` - Image generation

Each component has error handling and fallbacks to ensure the experience works even if one API fails!